<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="assets/css/custom/common.css" rel="stylesheet" type="text/css">
    <link href="assets/css/bootstrap/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="assets/js/jquery-1.12.3/jquery.js"></script>
    <script src="assets/js/jquery-nicescroll/jquery.nicescroll.js"></script>
    <script src="../../Build/Cesium/Cesium.js"></script>
    <script src="../js/FileSaver.min.js"></script>
    <script src="../js/jquery.wordexport.js"></script>
    <!--<script src="../js/jquery.PrintArea.js"></script>-->
    <script src="../js/jquery-migrate-1.2.1.min.js"></script>
    <script src="../js/jquery.jqprint-0.3.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/jquery.cookies.js"></script>
    <script src="../js/vue.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/function.js"></script>
    <script src="../js/basic.js"></script>

    <style>
        @import url(../../Build/Cesium/Widgets/widgets.css);
        .cesium-viewer-toolbar{
            left:5px;
        }
    </style>
</head>
<body>
<div class="ks_head">
    <div class="ks_container">
        <div class="ks_user">
            <div class="ks_photo">
                <img src="assets/img/main/photo.png">
            </div>
            <div class="ks_name">@Administrators</div>
        </div>
        <div class="ks_menu ks_menu_left">
            <a class="ks_menu_item dituHref" target="_self">
                <img src="assets/img/main/icon_01.png">
                <div class="ks_menu_title">地图</div>
            </a>
            <a class="ks_menu_item relationHref" target="_self">
                <img src="assets/img/main/icon_02.png">
                <div class="ks_menu_title">关系网络</div>
            </a>
            <a class="ks_menu_item" href="#">
                <img src="assets/img/main/icon_03.png">
                <div class="ks_menu_title">翻译</div>
            </a>
            <a class="ks_menu_item" href="#">
                <img src="assets/img/main/icon_04.png">
                <div class="ks_menu_title">图谱管理</div>
            </a>
        </div>
        <div class="ks_search">
            <input type="text">
            <span class="glyphicon glyphicon-search"></span>
        </div>
        <div class="ks_menu ks_menu_right">
            <a class="ks_menu_item" href="#">
                <img src="assets/img/main/icon_05.png">
                <div class="ks_menu_title">收藏</div>
            </a>
            <a class="ks_menu_item wordprint" href="#">
                <img src="assets/img/main/icon_06.png">
                <div class="ks_menu_title">打印</div>
            </a>
            <a class="ks_menu_item worddao" href="#">
                <img src="assets/img/main/icon_07.png">
                <div class="ks_menu_title">导出</div>
            </a>
            <a class="ks_menu_item" href="../main.html" target="_self" >
                <img src="assets/img/main/icon_08.png">
                <div class="ks_menu_title">返回地球</div>
            </a>
            <a class="ks_menu_item returnCountry">
                <img src="assets/img/main/icon_09.png">
                <div class="ks_menu_title">返回国家</div>
            </a>
        </div>
    </div>
</div>
<div class="ks_main" id="ks_main">
    <div class="w-100p ks_fl">
        <div class="ks_contrl w-80p ks_fl">
            <div class="ks_inner">
                <div class="ks_title">
                    突发事件处置
                </div>
                <div>
                    <div class="w-25p ks_crl">
                        <label>事发时间</label>
                        <input type="text" value="2000年1月1日" readonly>
                    </div>
                    <div class="w-25p ks_crl">
                        <label>事发地点</label>
                        <select>
                            <option>伊斯坦布尔</option>
                        </select>
                    </div>
                    <div class="w-25p ks_crl">
                        <label>事发类型</label>
                        <select>
                            <option>恐怖袭击</option>
                        </select>
                    </div>
                    <div class="w-25p ks_crl">
                        <label>参与组织</label>
                        <select>
                            <option>伊斯兰国</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="w-80p ks_fl ks-80p2">
        <div class="ks_panel_map w-100p ks_fl">
            <div class="ks_inner">
                <div id="map" class="ks_map">
                </div>
                <div class="addcircle">
                    <span class="glyphicon glyphicon-dashboard"></span>
                </div>
                <div class="ks_map_over">
                    <div class="ks_map_crl">
                        <div class="ks_select"  >
                            <!--<select>-->
                                <!--<option>交通</option>-->
                            <!--</select>-->
                            <p class="group"  onselectstart="return false;" style="-moz-user-select:none;"> 交通
                             <span class="glyphicon glyphicon-minus"></span> </p>
                            <ul class="traffic" onselectstart="return false;" style="-moz-user-select:none;">
                                <li id="hkjt"  obj='[
                                {
                                "name":"非政府机构",
                                "text": "非政府机构是一家很大的机构",
                                "lot":28.84,
                                "lat":41.12,
                                "type":"zhongguo"
                                },
                                {
                                "name":"DDD非政府机构",
                                "text": "DDD非政府机构是一家很老的机构",
                                "lot":28.88,
                                "lat":41.02,
                                "type":"zhongguo"
                                }
                                ]'> <span></span> <i>航空交通</i></li>
                                <li id="syjt"  obj='[
                                {
                                "name":"非政府机构",
                                "text": "非政府机构是一家很大的机构",
                                "lot":28.64,
                                "lat":41.12,
                                "type":"official"
                                },
                                {
                                "name":"DDD非政府机构",
                                "text": "DDD非政府机构是一家很老的机构",
                                "lot":28.98,
                                "lat":41.02,
                                "type":"official"
                                }
                                ]'> <span></span> <i>水运交通</i></li>
                                <li> <span></span> <i>陆运交通</i></li>
                                <li> <span></span> <i>铁路交通</i></li>
                            </ul>
                        </div>
                        <div class="ks_select">
                            <!--<select>-->
                                <!--<option>官方机构</option>-->
                            <!--</select>-->
                            <p class="group"  onselectstart="return false;" style="-moz-user-select:none;">机构
                                <span class="glyphicon glyphicon-minus"></span></p>
                            <ul class="traffic" onselectstart="return false;" style="-moz-user-select:none;">
                                <li> <span></span> <i>涉华官方机构</i></li>
                                <li> <span></span> <i>属地官方机构</i></li>
                                <li> <span></span> <i>中资机构</i></li>
                                <li> <span></span> <i>恐怖组织</i></li>
                                <li> <span></span> <i>安保小组</i></li>
                            </ul>
                        </div>
                        <div class="ks_select" onselectstart="return false;" style="-moz-user-select:none;">
                            <!--<select>-->
                                <!--<option>公共设施</option>-->
                            <!--</select>-->
                            <p class="group"  onselectstart="return false;" style="-moz-user-select:none;">其他
                                <span class="glyphicon glyphicon-minus"></span></p>
                            <ul class="traffic">
                                <li> <span></span> <i>医院</i></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="ks_panel hot-news-h w-100p ks_fl" >
            <div class="hot-news tab-content default">

                <div class="w-100p">
                    <div class="clearfix"></div>
                    <div style="padding: 0 10px">
                        <div class="page-header">
                            <h3 ><span style="color: #449d44;">热点新闻</span> <small onclick="window.open('main_newsContent.html?EntityID=' +  $.cookie('CountryEntityID') + '&type=' +  $.cookie('CountryType'));">更多</small></h3>
                        </div>
                    </div>
                    <div class="ks_fl w-50p" style="padding:0 10px;" v-for="(value,key) in newsContent" v-if="key < 2">
                        <div class="panel panel-hotnews" >
                            <div class="panel-heading"><span @click="openUrl(value)">{{value.title }} </span></div>
                            <div class="panel-body"  @click="openUrl(value)">
                                {{value.abstrct}}
                            </div>
                        </div>
                    </div>



                </div>

            </div>
        </div>

    </div>
    <div class="w-20p ks_fl">
        <div class="panel panel-primary">
            <div class="panel-heading"><img src="assets/img/main/panel_01.png">关联实体</div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th v-for="(value,key) in EntiryPart[0]" v-html="$options.filters.filterEntity(key)"></th>
                        <!-- 将过滤方法写在 v-html上  相当于1.0中 {{{ {{key | filterEvent}} }}}-->
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="value in EntiryPart">
                        <td v-for="td in value" v-html="td"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading"><img src="assets/img/main/panel_02.png">关联事件</div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th v-for="(value,key) in EventPart[0]" v-html="$options.filters.filterEvent(key)"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="value in EventPart">
                        <td v-for="(td,key) in value" v-html="$options.filters.timefilter(td,key)"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading"><img src="assets/img/main/panel_03.png">关联文档</div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <thead >
                    <tr>
                        <th v-for="(value,key) in DocPart[0]" v-if="key !== 'first'"  v-html="$options.filters.filterDocument(key)"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="value in DocPart">
                        <td v-for="(td,key) in value" v-if="key !== 'first'" v-html="$options.filters.timefilterTwo(td,key)"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading"><img src="assets/img/main/panel_04.png">多媒体</div>
            <div class="panel-body">
                <div class="ks_video">
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
//    isLogin();


$(function () {

    $(".returnCountry").attr("href","../pages/countryOverview.html?EntityID=" +$.cookie("CountryEntityID")+ "&type=" + $.cookie("CountryType") );
    $(".dituHref").attr("href",  "main_earths.html?EntityID=" +$.cookie("CountryEntityID")+ "&type=" + $.cookie("CountryType")   );
    $(".relationHref").attr("href",  "main_relation.html?EntityID=" +$.cookie("CountryEntityID")+ "&type=" + $.cookie("CountryType")   );
    $(".worddao").on("click",function(e){
        e.preventDefault();
        $("body").wordExport();
    });
    $(".wordprint").on("click",function(e){
        e.preventDefault();
        $("body").jqprint();
    });

    $(".ks_head .ks_search span.glyphicon").on("click",function(){
        var keyword = $(".ks_head .ks_search").find("input").val();
        $.ajax({
            type: "get",  //访问WebService使用get方式请求
            url: HOST, //调用WebService的地址和方法名称组合
            data: {
                method: "getAutoCart",
                keyword:encodeURI(keyword)
            },
            success: function (data) {
                var result = $(data).text();
                var resultData = JSON.parse(result);
                console.log(resultData);

                var width = $(window).width() / 1.5;
                var height = $(window).height() / 1.5;
                $.ajax({
                    "type": "get",
                    "url": "layer_autoCard.html",
                    "success": function (response, status, xhr) {
                        layer.open({
                            type: 1,
                            title: "自动卡片",
                            skin: "layui-layer-lbf", //添加类名
                            closeBtn: 1,
                            area: [width + "px", height + "px"],
                            shadeClose: true,
                            content: response,
                            success: function (layero,index) {
                                for (var i=0;i < resultData.length;i++){
                                    $(layero).find(".autoCard").append('<div class="col-xs-3 card-xs">\
                                                    <div class="nrcard">\
                                                     <h5 class="bg-primary" style="padding: 5px 0; text-indent: 10px;">卡片 — '+ (i+1) +'</h5>\
                                                      <table class="table table-condensed table-bordered table-striped">\
                                                                <tr><th>名称</th><td>'+resultData[i].name+'</td></tr>\
                                                                <tr><th>国家</th><td>'+resultData[i].country+'</td></tr>\
                                                                <tr><th>编号</th><td>'+resultData[i].id+'</td></tr>\
                                                                <tr><th>来源</th><td>'+resultData[i].source+'</td></tr>\
                                                                <tr><th>标签</th><td>'+resultData[i].tag+'</td></tr>\
                                                                <tr><th>类型</th><td>'+resultData[i].type+'</td></tr>\
                                                       </table>\
                                                    </div>\
                                           </div>');
                                }
                            }
                        });
                    }
                });

            },
            "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
            }
        });





    });

    var ks_main = new Vue({
        el: "#ks_main",
        data: {
            EntiryPart: "",
            EventPart: "",
            DocPart: "",
            newsContent: ""
        },
        methods: {
            "openUrl": function (val) {
                var width = $(window).width() / 1.5;
                var height = $(window).height() / 1.5;
                $.ajax({
                    "type": "get",
                    "url": "layer_module.html",
                    "success": function (response, status, xhr) {
                        layer.open({
                            type: 1,
                            title: val.title,
                            skin: "layui-layer-lbf", //添加类名
                            closeBtn: 1,
                            area: [width + "px", height + "px"],
                            shadeClose: true,
                            content: response,
                            success: function () {
                                $(".text-area").html(val.abstrct);
                                $(".news-container").find('h2').html(val.title);
                            }
                        });
                    }
                });
            }
        },
        mounted: function () {
           $(".ks_select").find(".group").on("click",function(){
               $(this).next("ul").toggle()
               if($(this).find("span").hasClass("glyphicon-minus")){
                   $(this).find("span").removeClass("glyphicon-minus").addClass("glyphicon-plus");
               }else if($(this).find("span").hasClass("glyphicon-plus")){
                   $(this).find("span").removeClass("glyphicon-plus").addClass("glyphicon-minus");
               }
           });


            $.ajax({
                type: "get",  //访问WebService使用get方式请求
                url: HOST, //调用WebService的地址和方法名称组合
                data: {
                    method: "getCountViews",
                    node_type:"Country",
                    node_id : "10002",
                    AssociatedEntity : "all",
                    level : 2
                },
                success: function (data) {
                    var result = $(data).text();
                    var resultData = JSON.parse(result);
                    var videoData = JSON.parse(resultData.video);

                    if(videoData.length == 0){
                        $(".ks_video").html("<p>暂无视频</p>");
                    }else{
                        for (var videoL=0; videoL < videoData.length;videoL++ ){
                            $(".ks_video").append("<video width='100%' height='100%' controls>\
                                                    <source src='"+ videoData[videoL] +"' type='video/mp4'>\
                                                     </video>")
                        }
                    }

                },
                "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                    alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                }
            });

            $.ajax({
                type: "get",  //访问WebService使用get方式请求
                url: HOST, //调用WebService的地址和方法名称组合
                data: {
                    method: "getCountryAndLogo",
                    EntityID: $.cookie("CountryEntityID"),
                },
                success: function (data) {
                    var result = $(data).text();
                    var resultJSON = JSON.parse(result);
                    var countryName = resultJSON.EntityName;
                    $.ajax({
                        type: "get",  //访问WebService使用get方式请求
                        url: HOST, //调用WebService的地址和方法名称组合
                        data: {
                            method: "getNewsFromES",
                            key: encodeURI(countryName),
                            type : ""
                        },
                        success: function (data) {
                            var result = $(data).text();
                            var resultJSON = JSON.parse(result);

                            ks_main.newsContent = resultJSON;

                        },
                        "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                            alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                        }

                    });


                },
                "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                    alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                }

            });
            $.ajax({
                type: "get",  //访问WebService使用get方式请求
                url: HOST, //调用WebService的地址和方法名称组合
                data: {
                    method: "getCardRightEntiryPart",
                    nodeType:$.cookie("CountryType"),
                    nodeId: $.cookie("CountryEntityID")
                },
                success: function (data) {
                    var result = $(data).text();
                    var resultJSON = JSON.parse(result);
                    ks_main.EntiryPart = resultJSON;

                },
                "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                    alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                }

            });
            $.ajax({
                type: "get",  //访问WebService使用get方式请求
                url: HOST, //调用WebService的地址和方法名称组合
                data: {
                    method: "getCardRightEventPart",
                    nodeType:$.cookie("CountryType"),
                    nodeId: $.cookie("CountryEntityID")
                },
                success: function (data) {
                    var result = $(data).text();
                    var resultJSON = JSON.parse(result);
                    ks_main.EventPart = resultJSON;

                },
                "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                    alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                }

            });
            $.ajax({
                type: "get",  //访问WebService使用get方式请求
                url: HOST, //调用WebService的地址和方法名称组合
                data: {
                    method: "getCardRightDocPart",
                    nodeType:$.cookie("CountryType"),
                    nodeId: $.cookie("CountryEntityID")
                },
                success: function (data) {
                    var result = $(data).text();
                    var resultJSON = JSON.parse(result);
                    ks_main.DocPart = [{
                        third : null,
                        second : null
                    }];
                    ks_main.DocPart[0].third = resultJSON[0].third;
                    ks_main.DocPart[0].second = resultJSON[0].second;
                },
                "error": function (xhr, errorText, errorStatus) {  //访问错误后的回调函数  第一个参数对象 第二个错误的文本 第三个错误的类型
                    alert("ajax访问错误:" + xhr.status + " " + xhr.statusText);        //错误的编号 和文本
                }

            });



            $(".ks_panel_right > .ks_inner table tbody").niceScroll({
                styler: "fb",
                cursorcolor: "#959595",
                cursorwidth: '6',
                cursorborderradius: '15px',
                background: '#eee',
                cursorborder: '',
                zindex: 5
            });

            var viewer = new Cesium.Viewer('map', {  //cesiumContainer 为div的id标签
                animation: false, //是否创建动画小器件，左下角仪表   改控件为地球自转 背景星空的动画
                baseLayerPicker : false, //baseLayerPicker小部件控制不显示    右上角 图层选择器
                fullscreenButton : false, //fullscreenButton小部件控制不显示 右下角 显示全屏按钮
                geocoder : false,//是否显示geocoder小器件，右上角查询按钮
                homeButton : true,//是否显示Home按钮 右上角Home按钮
                timeline: false, //时间线控制不显示 底部
                imageryProvider: Cesium.createTileMapServiceImageryProvider({
                    url : '../bingMap/tiles',
                    fileExtension: 'jpg',
                    maximumLevel : 9
                }),
                navigationHelpButton: false, //帮助按钮控制不显示 右上角
                scene3DOnly : true,//如果设置为true，则所有几何图形以3D模式绘制以节约GPU资源
                sceneModePicker : false,//是否显示3D/2D选择器  必须scene3DOnly设置为false 才可以设置为true显示
                selectionIndicator : true,//是否显示选取指示器组件  点击后是否显示选取框
                infoBox: true //点击图层对象后 是否显示该对象的信息 是否显示信息框 可在 geojson文件中 properties这个对象里 添加属性作为信息框的信息
            });
            var ellipsoid = Cesium.Ellipsoid.WGS84;
            var canvas = viewer.canvas;
            var handler = new Cesium.ScreenSpaceEventHandler(canvas); // 为画布/元素 添加事件实例
            var scene = viewer.scene;

//            var ystbr = viewer.imageryLayers.addImageryProvider(new Cesium.createTileMapServiceImageryProvider({ // WMTS层(网络地图瓦片服务)
//                url : "../ystbr",
//                fileExtension: 'jpg',
//                maximumLevel : 16
//            }));

            //点击Home按钮 回到的镜头位置和方向
            viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(){
                Cesium.requestAnimationFrame(function() {
                    viewer.camera.flyTo({  //图片动画飞向指定坐标
                        destination :Cesium.Cartesian3.fromDegrees(28.88,41.10,120000.0), //经度 纬度 视距高度  /该方法返回一个笛卡尔坐标 Cesium.Cartesian3.fromDegrees(28.88,41.10,150000.0)
                        orientation: {
                            heading : 0.0, //头部
                            pitch : -Cesium.Math.PI_OVER_TWO, //俯仰
                            roll : 0.35 //滚动  0.35
                        }
                    });
                });
            });

            //设置整体实例默认镜头位置与方向
            viewer.camera.setView({
                destination :Cesium.Cartesian3.fromDegrees(28.88,41.10,120000.0), //经度 纬度 视距高度  /该方法返回一个笛卡尔坐标 Cesium.Cartesian3.fromDegrees(28.88,41.10,150000.0)
                orientation: {
                    heading : 0.0, //头部
                    pitch : -Cesium.Math.PI_OVER_TWO, //俯仰
                    roll : 0.35 //滚动  0.35
                }
            });
            viewer.scene.screenSpaceCameraController.maximumZoomDistance = 120000.0; //镜头最小高度设置
            viewer._cesiumWidget._creditContainer.style.display = 'none'; //隐藏cesium水印

            $(".ks_select .traffic").find("li").on("click",function(){
                if($(this).attr("active") === undefined ||  $(this).attr("active") === "false"){
                    $(this).attr("active","true").find("span").css("background-color","#65C5FE").end().find("i").css("color","#fff");

                    if(($(this).attr("obj") !== undefined) && ($(this).attr("obj") !== "") ){ //判断原始 是否有obj属性
                        var dataValue = JSON.parse($(this).attr("obj"));
                        var idLength = 0;
                        for(var d=0;d<viewer.dataSources.length;d++){ //判断是否已经czml已经生成过了
                            if(viewer.dataSources.get(d).name == $(this).attr("id")){
                                viewer.dataSources.get(d).show = true;
                                idLength++;
                            }
                        }
                        if(idLength > 0){
                            return;
                        }
                        //没生成过CZML 则初始化
                        var czml = [{
                            "id" : "document",
                            "name" : $(this).attr("id"),
                            "version" : "1.0"
                        }];
                        for(var i =0;i<dataValue.length;i++){
                            czml.push({
                                "name":dataValue[i].name,
                                "description" : dataValue[i].text,
                                "billboard" : {
                                    "image" : "assets/img/main/"+  dataValue[i].type +".png",
                                    "width": 45,
                                    "height" : 45
                                },
                                "position" : {
                                    "cartographicDegrees" : [dataValue[i].lot, dataValue[i].lat, 0.0]
                                }

                            });
                            viewer.dataSources.add(Cesium.CzmlDataSource.load(czml));
                        }
                    }
                }else if( $(this).attr("active") === "true"){
                    for(var d=0;d<viewer.dataSources.length;d++){
                        if(viewer.dataSources.get(d).name == $(this).attr("id")){
                            viewer.dataSources.get(d).show = false;
                        }
                    }
                    $(this).attr("active","false").find("span").css("background-color","#BBB").end().find("i").css("color","#BBB");
                }
            });



            $(".addcircle").on("click",function(){
                handler.setInputAction(function (movement) {
                    var cartesian = viewer.camera.pickEllipsoid(movement.endPosition, scene.globe.ellipsoid);
                    if (cartesian) {
                        $("canvas").css("cursor", "crosshair");
                        var cartographic = Cesium.Cartographic.fromCartesian(cartesian);
                        var longitudeString = Cesium.Math.toDegrees(cartographic.longitude).toFixed(2);
                        var latitudeString = Cesium.Math.toDegrees(cartographic.latitude).toFixed(2);
                        handler.setInputAction(function (movement) {
                            $("canvas").css("cursor", "default");
//                    alert(longitudeString + "---" + latitudeString )
                            viewer.dataSources.removeAll();
                            viewer.entities.removeAll();
                            var entity = viewer.entities.add({
                                position: Cesium.Cartesian3.fromDegrees(longitudeString,latitudeString),
                                ellipse : {
                                    semiMinorAxis : 5000.0,
                                    semiMajorAxis : 5000.0,
                                    material : Cesium.Color.BLUE.withAlpha(0.5)
                                }
                            });
                            var centerArry = [];
                            $(".traffic").find("li").each(function(){
                                if($(this).attr("obj") !== undefined){
                                    var objValue = JSON.parse($(this).attr("obj"));
                                    for(var i =0;i < objValue.length;i++){
                                        var geodesic = new Cesium.EllipsoidGeodesic(ellipsoid.cartesianToCartographic(Cesium.Cartesian3.fromDegrees(longitudeString,latitudeString)), ellipsoid.cartesianToCartographic(Cesium.Cartesian3.fromDegrees(objValue[i].lot,objValue[i].lat)));
                                        if(geodesic.surfaceDistance < 5000){
                                            objValue[i].id = $(this).attr("id");
                                            centerArry.push(objValue[i]);
                                        }
                                    }
                                }
                            });



                            for(var d = 0;d <centerArry.length;d++){
                                var czml = [{
                                    "id" : "document",
                                    "version" : "1.0"
                                }, {
                                    "name":centerArry[d].name,
                                    "description" : centerArry[d].text,
                                    "billboard" : {
                                        "image" : "assets/img/main/"+  centerArry[d].type +".png",
                                        "width": 45,
                                        "height" : 45
                                    },
                                    "position" : {
                                        "cartographicDegrees" : [centerArry[d].lot, centerArry[d].lat, 0.0]
                                    }

                                }];
                                viewer.dataSources.add(Cesium.CzmlDataSource.load(czml));

                            }
                            handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);
                            handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
                        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                    } else {
                        $("canvas").css("cursor", "default");
                        label.label.show = false;
                        handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
                    }
                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

            });


            $(".ks_select .traffic").find("li").on({
                "mouseenter" : function(){
                    if($(this).attr("active") === undefined ||  $(this).attr("active") === "false"){
                        $(this).find("span").css("background-color","#DDD").end().find("i").css("color","#DDD");
                    }
                },
                "mouseleave" : function(){
                    if($(this).attr("active") === undefined ||  $(this).attr("active") === "false") {
                        $(this).find("span").css("background-color", "#BBB").end().find("i").css("color", "#BBB");
                    }
                }

            });



        },
        filters: {
            textfilter: function (value) {
                if (typeof value == 'string') {
                    return value;
                } else if (typeof value == 'object') {
                    var text = "";
                    for (var i in value) {
                        text +=  "<strong>"+ i + "</strong>"  + "：" + value[i] + "<br/>";

                    }
                    return text;
                }

            },
            filterEntity: function (value) {
                switch (value) {
                    case "first":
                        return "类型";
                        break;
                    case "second":
                        return "名称";
                        break;
                    case "third":
                        return "关系";
                        break;
                }
            },
            filterEvent: function (value) {
                switch (value) {
                    case "first":
                        return "时间";
                        break;
                    case "second":
                        return "事件";
                        break;
                }
            },
            filterDocument: function (value) {
                switch (value) {
                    case "first":
                        return "类型";
                        break;
                    case "second":
                        return "时间";
                        break;
                    case "third":
                        return "文档";
                        break;
                }
            },
            timefilter: function (value, key) {
                if (key == "first") {
                    var time = new Date(parseInt(value) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
                    return time;
                }
                return value;
            },
            timefilterTwo: function (value, key) {
                if (key == "second") {
                    var time = new Date(parseInt(value) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
                    return time;
                }
                return value;
            }
        }
    });



});











</script>